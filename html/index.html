<!DOCTYPE html>
<html>
	<head>
	    <title>Destop MQTT Broker and Serial Bridge</title>
		<link href="../css/bootstrap.min.css" media="all" rel="stylesheet" type="text/css" />
		<link href="../css/bootstrap-theme.min.css" media="all" rel="stylesheet" type="text/css" />
		<link href="../css/style.css" media="all" rel="stylesheet" type="text/css" />
		<script src="../js/jquery-2.1.3.min.js"></script>
		<script src="../js/bootstrap.min.js"></script>
		<script src="../js/main.js"></script>
	</head>
	<style>
	label {
		display: block;
	}
	#mqtt-container {
		height: 200px;
	}
	</style>
	<body>
		<div class="outer">
			<div role="tabpanel">
				<ul class="nav nav-tabs" role="tablist" id="myTab">
					<li role="presentation" class="active"><a href="#mqtt" aria-controls="mqtt" role="tab">MQTT Broker</a></li>
					<li role="presentation" ><a href="#serial" aria-controls="serial" role="tab" >Serial Bridge</a></li>
					<li role="presentation" ><a href="#help" aria-controls="help" role="tab" >Help</a></li>
				</ul>
				<div class="tab-content">
					<div role="tabpanel" class="tab-pane active" id="mqtt">
						<div id="mqtt-container">
							<div class="mqtt-inputs">
								MQTT Port: <input id="mqtt-port" />
								MQTT Websocket Port: <input id="mqtt-ws-port" />
							</div>
							<table class="table table-striped table-bordered" id="ip-addr-container">
								<tr><td colspan="2">IP Addresses/s</td></tr>
							</table>
							<div class="mqtt-status">
								MQTT Status: <span id="mqtt-status">Stopped</span>
							</div>
							<button id="mqtt-start" class="btn btn-primary">Start MQTT Broker</button>
						</div>

					</div>
					<div role="tabpanel" class="tab-pane" id="serial">
						<h3>MQTT Broker Address:Port</h3>
						<input id="bridge-mqtt-broker-addr" value="localhost:1883" size="60">
						<button class="btn" id="clientConnect">Connect</button>
						<h3>Select a serial port:</h3>
						<form id="serialports" action=""></form>
						<div class="serialPortStatus">
							<p>Currrent Serial Port: <span id="current-port">None selected</span></p>
						</div>
						<button id="connect-serial" class="btn btn-primary">Connect</button>
					</div>
					<div role="tabpanel" class="tab-pane" id="help">
						<h1>Help</h1>
						<h2>MQTT Broker</h2>
						<p>The MQTT broker we supply is a simple configuration of Mosca, from Matteo Collina https://github.com/mcollina/mosca.</p>
						<p> Running it is simple, just click start and you'll have a MQTT broker running on your local machine.</p>
						<p>The only configuration options are the port to use for regular connections, which defaults to the MQTT standard 1833, and the port for websocket connects, which has no standard, but we default to 9001</p>
						<p>To keep things simple we list the IP address(es) of your machine, so that you can configure your MQTT clients to connect to the broker easily.</p>
						<h2>MQTT to Serial Bridge</h2>
						<p>Many low cost microcontrollers have no networking hardware and so cannot connect to an MQTT broker directly. To allow, say, a Plain Old Arduino to connect to the MQTT broker, we have created a simple bridge to convert MQTT messages and commands to and from a serial port.</p>
						<p>To use the bridge, enter the IP address and port of your MQTT broker and press connect. If you are using the built-in MQTT broker in the other panel, you don't need to do anything, the bridge is pre-set to connect to that</p>
						<p>Next, select the serial port of your device, and press connect. Remember to disconnect the port if you are going to use it to download a new version of firmware, with say the Arduino IDE</p>
						<h3>Sending commands from the microcontroller.</h3><p> If you send the string "publish:atopic:mymessage" the bridge will publish a the message "mymessage" to the topic "atopic". Similarly, if you send the string "subscribe:anothertopic", the bridge will subscribe to the topic "anothertopic".</p>
						<h3>Receiving data from the bridge. </h3><p>The bridge will send messages to the microcontroller in the format "topic:message"</p>
						<p>You can see an example of an Arduino using the serial bridge at https://github.com/mkarliner/ThingStudioExamples.git</p>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script type="text/javascript">
		$('#myTab a').click(function (e) {
	  		e.preventDefault();
	  		$(this).tab('show');
		});
	</script>
</html>